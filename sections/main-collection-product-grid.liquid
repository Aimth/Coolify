{{ 'template-collection.css' | asset_url | stylesheet_tag }}
{{ 'component-loading-overlay.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{% comment %} <script src="{{ 'collection-main.js' | asset_url }}" defer="defer"></script> {% endcomment %}
{% liquid
  assign gst = settings
  assign sst = section.settings
  assign container = sst.container
  assign filter_type = sst.filter_type
  assign show_product_count = sst.show_product_count
  assign show_list_grid = sst.show_list_grid
  assign enable_sorting = sst.enable_sorting
  assign columnProductSettings = sst.column_number | plus: 0
  assign column_show = columnProductSettings
  assign column_show = cart.attributes.collection_products_column_show | default: columnProductSettings | plus: 0
  if column_show > columnProductSettings
    assign column_show = columnProductSettings
  endif
%}
{%- capture style -%}
  --section-padding-top: {{ sst.padding_top }}px; 
  --section-padding-bottom: {{ sst.padding_bottom }}px;
{%- endcapture -%}

{% capture classWrapper %}
  {% if filter_type == 'left_sidebar' or filter_type == 'right_sidebar' %}
    facets-vertical flex {% if section.settings.background_sidebar == 'no_background' %} gap-60 {% else %}gap-30{% endif %}
  {% elsif filter_type == 'drawer' %}
    facets-drawer
  {% endif %}
  {% if filter_type == 'right_sidebar' %}
   flex-row-reverse
  {% endif %}
{% endcapture %}
<div class="tp-main-clc color-{{ sst.color_scheme }} gradient section-py {% if sst.reset_spacing == false %}section-mb{% endif %} product-item-list" style="{{ style | strip | strip_newlines }}">
  <div class="{{ container }}">
    {%- paginate collection.products by section.settings.products_per_page -%}
      <div class="{{ classWrapper | strip | strip_newlines }}">
        {{ 'component-facets.css' | asset_url | stylesheet_tag }}
        <script src="{{ 'facets.js' | asset_url }}" defer="defer"></script>
        {%- if section.settings.enable_filtering -%}
          <aside
            aria-labelledby="verticalTitle"
            class="facets-wrapper"
            id="main-collection-filters"
            data-id="{{ section.id }}">
            <div class="btn-close-filter absolute top-0 right-0 p-8 {% if filter_type == 'drawer' %}block{% else %}block lg:hidden{% endif %}">
              <button class="btn-close-filter__innner flex items-center tp-icon-close">
                {% render 'icon'
                  , icon_name: 'close'
                  , width: 15
                  , height: 15 %}
              </button>
            </div>
            {% render 'facets'
              , results: collection
              , collections: section.settings.collection_list
              , enable_filtering: section.settings.enable_filtering
              , enable_sorting: section.settings.enable_sorting
              , filter_type: section.settings.filter_type
              , paginate: paginate
              , background_sidebar: section.settings.background_sidebar
              , block: block
            %}
          </aside>
        {%- endif -%}

        <div class="product-grid-container" id="ProductGridContainer">
          <div class="tp-main-clc__topbar">
            <div class="flex justify-between items-stretch flex-col md:flex-row mb-40">
              <div class="topbar-left flex items-center justify-between gap-20 mb-16 md:mb-0">
                <div class="action-col-prd-list flex items-center gap-24">
                  {% if show_list_grid %}
                    <ul class="list-grid-bar flex items-center gap-20 list-none">
                      <li
                        flow="up"
                        tooltip="Grid"
                        class="{% if column_show != 1 %}active {% endif %} action-col-prd"
                        data-type="{{ sst.column_number }}"
                        data-view="grid">
                        <span class="pointer-events-none block">
                          {% render 'icon'
                            , icon_name: 'icon-grid' %}
                        </span>
                      </li>

                      <li
                        flow="up"
                        tooltip="{{ 'tooltip.list' | t }}"
                        class="{% if column_show == 1 %}active {% endif %}action-col-prd grid-1-col"
                        data-type="1"
                        data-view="list">
                        <span class="pointer-events-none block">
                          {% render 'icon'
                            , icon_name: 'icon-grid-1-col' %}
                        </span>
                      </li>
                    </ul>
                  {% endif %}

                  {% unless filter_type == 'no_sidebar' %}
                    <div class="btn-filter {% if filter_type == 'drawer' %}block{% else %}block lg:hidden{% endif %}">
                      <button class="btn-filter__innner flex items-center px-16 py-8 bg-primary tp-icon-close uppercase  text-sm">
                        {{ 'products.facets.filter_button' | t }}
                      </button>
                    </div>
                  {% endunless %}
                </div>
                {% comment %} <p class="mb-0">Showing {{ 'products.facets.product_count_simple' | t: count: collection.products_count }} of {{ collection.products_count }} products</p> {% endcomment %}
                {% if show_product_count %}
                  <div class="product-count-clc" role="status">
                    <p id="ProductCountDesktop" class="mb-0">
                      {%- if collection.results_count -%}
                        {{ 'templates.search.results_with_count' | t: terms: collection.terms, count: collection.results_count }}
                      {%- elsif collection.products_count == collection.all_products_count -%}
                        {{ 'products.facets.product_count_simple' | t: count: collection.products_count }}
                      {%- else -%}
                        {{ 'products.facets.product_count' | t: product_count: collection.products_count, count: collection.all_products_count }}
                      {%- endif -%}
                    </p>
                  </div>
                {% endif %}
              </div>
              {%- if enable_sorting -%}
                <div class="topbar-right flex items-center gap-20">
                  <p class="mb-0">
                    {{ 'products.facets.sort_by_label' | t }}</p>
                  <facet-filters-form class="facets facets-vertical-sort no-js-hidden">
                    <form class="facets-vertical-form" id="FacetSortForm">
                      {%- assign sort_by = collection.sort_by | default: collection.default_sort_by -%}
                      <div class="facet-filters sorting">
                        <div class="facet-filters__field">
                          <button
                            type="button"
                            class="btn-select-filter-sort"
                            data-value="{{ sort_by }}">
                            <span>
                              {%- for option in collection.sort_options -%}
                                {% if option.value == sort_by %}
                                  {% assign sortByActiveName = option.name %}
                                  {% break %}
                                {% endif %}
                              {%- endfor -%}

                              {{ sortByActiveName }}
                            </span>
                            {% render 'icon'
                              , icon_name: 'dropdown'
                              , class: 'pointer-events-none' %}
                          </button>

                          <div
                            aria-describedby="a11y-refresh-page-message"
                            class="facet-filters__sort {% if filter_type == 'drawer' %}left-0{% endif %}"
                            id="SortBy"
                            name="sort_by">
                            <input
                              type="hidden"
                              name="sort_by"
                              value="{{ sort_by }}">

                            {%- for option in collection.sort_options -%}
                              <span value="{{ option.value }}" class="item-sort{% if option.value == sort_by %} is-selected{% endif %}">
                                {{- option.name | escape -}}
                              </span>
                            {%- endfor -%}
                          </div>
                        </div>
                      </div>
                    </form>
                  </facet-filters-form>
                </div>
              {%- endif -%}
            </div>
            {% liquid
              assign checkValue = false
              for filter in collection.filters
                for value in filter.active_values
                  assign activeCount = forloop.length
                  assign checkValue = true
                endfor
              endfor
            %}

            <div class="active-facets flex flex-wrap items-center gap-12 {% if activeCount != blank %} mb-32{% endif %}">
              {%- for filter in collection.filters -%}
                {%- for value in filter.active_values -%}
                  {% assign activeValueCount = forloop.length %}
                  <facet-remove class="item-active p-8 mb-8 bd-radius">
                    <a href="{{ value.url_to_remove }}" class="flex items-center gap-8">
                      <span>
                        {% render 'icon'
                          , icon_name: 'icon-close-border' %}</span>
                      <span class="text-sm">
                        {{ filter.label }}:
                        {{ value.label | escape }}
                      </span>
                    </a>
                  </facet-remove>
                {%- endfor -%}
                {% if filter.type == 'price_range' %}
                  {%- if filter.min_value.value != null or filter.max_value.value != null -%}
                    <facet-remove class="item-active p-8 bd-radius {% if checkValue == true %} mb-8{% else %}mb-32{% endif %}">
                      <a href="{{ filter.url_to_remove }}" class="flex items-center gap-8">
                        <span>
                          {% render 'icon'
                            , icon_name: 'icon-close-border' %}</span>
                        <span class="text-sm">
                          {%- if filter.min_value.value -%}
                            {{ filter.min_value.value | money }}
                          {%- else -%}
                            {{ 0 | money }}
                          {%- endif -%}
                          -
                          {%- if filter.max_value.value -%}
                            {{ filter.max_value.value | money }}
                          {%- else -%}
                            {{ filter.range_max | money }}
                          {%- endif -%}
                        </span>
                      </a>
                    </facet-remove>
                  {%- endif -%}
                {% endif %}

                {% if filter.min_value.value != null or filter.max_value.value != null or activeValueCount > 0 %}
                  {% assign showClearAll = true %}
                {% endif %}
              {%- endfor -%}

              {% if showClearAll %}
                <a href="{{ collection.url }}" class="clear-all fw-secondary {% if checkValue == false %} mb-32{% else %} mb-8{% endif %}">
                  {{- 'sections.collection_template.clear_all' | t -}}
                </a>
              {% endif %}
            </div>
          </div>
          {% assign desc_pos = section.settings.display_position %}
          {% if section.settings.show_description and desc_pos == 'top' and collection.description != blank %}
            <div class="product-grid__desc mb-40 flex flex-col items-center{% if section.settings.is_collapse_description %} is-collapse{% endif %}">
              <div class="desc-content mb-5 relative">
                {{ collection.description }}
                {% if section.settings.is_collapse_description %}
                  <div class="desc-gradient"></div>
                {% endif %}
              </div>

              {% if section.settings.is_collapse_description %}
                <button class="btn-more underline  underline-offset-2 pdp_view_description_button cursor-pointer" data-view="more">
                  {{ 'sections.collection_template.view_more' | t }}
                </button>
                <button class="pdp_view_description_button underline  underline-offset-2 hidden cursor-pointer mt-12" data-view="less">
                  {{ 'sections.collection_template.less_more' | t }}
                </button>
              {% endif %}
            </div>
          {% endif %}
          {%- if collection.products.size == 0 -%}
            <div
              class="collection collection--empty"
              id="product-grid"
              data-id="{{ section.id }}">
              <div class="loading-overlay gradient h-full"></div>
              <div class="title-wrapper center">
                <p class="title title--primary mb-0">
                  {{ 'sections.collection_template.empty' | t -}} &nbsp; {{ 'sections.collection_template.use_fewer_filters_html' | t: link: collection.url, class: 'tp-btn tp-btn__underline' }}
                </p>
              </div>
            </div>
          {%- else -%}
            <div class="collection js-tp-collection">
              <div class="tp-loading-overlay gradient">
                <span class="loading-notification"></span>
              </div>
              <ul
                id="product-grid"
                data-id="{{ section.id }}"
                class="tp-grid product-grid tp-grid--{{ column_show }}-col-desktop tp-grid--2-col-mobile list-none"
                {% if paginate.next.url != blank %}
                data-url="{{ paginate.next.url }}"
                {% endif %}>
                {%- for product in collection.products -%}
                  <li class="tp-grid__item">
                    {% liquid
                      render 'product-item-layout-1', card_product: product
                    %}
                  </li>
                {%- endfor -%}
              </ul>
              {% if sst.pagination == 'default' %}
                {%- if paginate.pages > 1 -%}
                  {% render 'pagination'
                    , paginate: paginate
                    , anchor: ''
                    , position_pagination: 'justify-center' %}
                {%- endif -%}
              {% elsif sst.pagination == 'load_more' %}
                {% render 'button-loadmore'
                  , paginate: paginate
                  , sst: sst
                  , collection: collection
                  , type: 'click' %}
              {% else %}
                {% render 'button-loadmore'
                  , paginate: paginate
                  , sst: sst
                  , collection: collection
                  , type: 'scroll' %}
              {% endif %}
            </div>
            {% if section.settings.show_description and desc_pos == 'bottom' and collection.description != blank %}
              <div class="product-grid__desc mt-40 flex flex-col items-center{% if section.settings.is_collapse_description %} is-collapse{% endif %}">
                <div class="desc-content mb-5 relative">
                  {{ collection.description }}
                  {% if section.settings.is_collapse_description %}
                    <div class="desc-gradient"></div>
                  {% endif %}
                </div>

                {% if section.settings.is_collapse_description %}
                  <button class="btn-more underline  underline-offset-2 pdp_view_description_button cursor-pointer" data-view="more">
                    {{ 'sections.collection_template.view_more' | t }}
                  </button>
                  <button class="pdp_view_description_button underline  underline-offset-2 hidden cursor-pointer mt-12" data-view="less">
                    {{ 'sections.collection_template.less_more' | t }}
                  </button>
                {% endif %}
              </div>
            {% endif %}
          {%- endif -%}
        </div>
      </div>
    {%- endpaginate -%}
  </div>
</div>

{% schema %}
  {
    "name": "t:sections.main-collection-product-grid.name",
    "tag": "section",
    "class": "section",
    "settings": [
      {
        "type": "header",
        "content": "General"
      },
      {
        "type": "select",
        "id": "container",
        "label": "Layout",
        "default": "container",
        "options": [
          {
            "value": "container",
            "label": "Default"
          }, {
            "value": "container-fluid",
            "label": "Fluid container"
          }, {
            "value": "full-width",
            "label": "Full width"
          }
        ]
      },
      {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "t:sections.all.colors.label",
        "default": "background-1"
      },
      {
        "type": "range",
        "id": "products_per_page",
        "min": 8,
        "max": 24,
        "step": 1,
        "default": 16,
        "label": "t:sections.main-collection-product-grid.settings.products_per_page.label"
      }, {
        "type": "select",
        "id": "column_number",
        "label": "Column product on desktop",
        "options": [
          {
            "value": "2",
            "label": "2 column"
          }, {
            "value": "3",
            "label": "3 column"
          }, {
            "value": "4",
            "label": "4 column"
          }
        ],
        "default": "3"
      }, {
        "type": "header",
        "content": "Description"
      }, {
        "type": "checkbox",
        "id": "show_description",
        "label": "Show description",
        "default": false
      }, {
        "type": "checkbox",
        "id": "is_collapse_description",
        "label": "Is collapse description",
        "default": true
      }, {
        "type": "select",
        "id": "display_position",
        "label": "Display position",
        "options": [
          {
            "value": "top",
            "label": "Top"
          }, {
            "value": "bottom",
            "label": "Bottom"
          }
        ],
        "default": "top"
      }, {
        "type": "select",
        "id": "pagination",
        "label": "Pagination",
        "default": "default",
        "options": [
          {
            "value": "default",
            "label": "Default"
          }, {
            "value": "load_more",
            "label": "Load more"
          }, {
            "value": "infinit_scrolling",
            "label": "Infinit scrolling"
          }
        ]
      }, {
        "type": "paragraph",
        "content": "----------------------------------------"
      }, {
        "type": "header",
        "content": "Toolbar settings"
      }, {
        "type": "checkbox",
        "id": "show_product_count",
        "default": true,
        "label": "Show product count"
      }, {
        "type": "checkbox",
        "id": "show_list_grid",
        "default": true,
        "label": "Show list, grid bar"
      }, {
        "type": "checkbox",
        "id": "enable_sorting",
        "default": true,
        "label": "t:sections.main-collection-product-grid.settings.enable_sorting.label"
      }, {
        "type": "paragraph",
        "content": "----------------------------------------"
      }, {
        "type": "header",
        "content": "Sidebar & filters"
      }, {
        "type": "checkbox",
        "id": "enable_filtering",
        "default": true,
        "label": "t:sections.main-collection-product-grid.settings.enable_filtering.label",
        "info": "t:sections.main-collection-product-grid.settings.enable_filtering.info"
      }, {
        "type": "checkbox",
        "id": "collab_first",
        "label": "Enable auto open first collab",
        "default": true
      }, {
        "type": "select",
        "id": "filter_type",
        "options": [
          {
            "value": "drawer",
            "label": "t:sections.main-collection-product-grid.settings.filter_type.options__3.label"
          }, {
            "value": "left_sidebar",
            "label": "Left sidebar"
          }, {
            "value": "right_sidebar",
            "label": "Right sidebar"
          }, {
            "value": "no_sidebar",
            "label": "No sidebar"
          }
        ],
        "default": "left_sidebar",
        "label": "Sidebar position on desktop"
      }, {
        "type": "select",
        "id": "background_sidebar",
        "label": "Background type",
        "default": "background",
        "options": [
          {
            "value": "no_background",
            "label": "No background"
          }, {
            "value": "background",
            "label": "Has background"
          }
        ],
        "info": "Applies to type has a background"
      }, {
        "type": "color",
        "id": "bg_color_sidebar",
        "label": "Background sidebar",
        "default": "#EEF2F6"
      }, {
        "type": "collection_list",
        "id": "collection_list",
        "label": "Collections"
      }, {
        "type": "select",
        "id": "price_type",
        "default": "range_slider",
        "label": "Price filter type",
        "options": [
          {
            "value": "default",
            "label": "Default"
          }, {
            "value": "range_slider",
            "label": "Range Sliders"
          }
        ]
      }, {
        "type": "paragraph",
        "content": "----------------------------------------"
      }, {
        "type": "header",
        "content": "t:sections.all.padding.section_padding_heading"
      }, {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_top",
        "default": 36
      }, {
        "type": "range",
        "id": "padding_bottom",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_bottom",
        "default": 36
      }, {
        "type": "checkbox",
        "id": "reset_spacing",
        "label": "Remove default space between sections",
        "default": false
      }
    ],
    "blocks": [
      {
        "type": "categories",
        "name": "Categories",
        "limit": 1,
        "settings": [
          {
            "type": "text",
            "id": "title",
            "label": "Title",
            "default": "Category"
          }, {
            "type": "collection_list",
            "id": "collection_list",
            "label": "Collections"
          }
        ]
      }, {
        "type": "filter",
        "name": "Filter",
        "limit": 1
      }, {
        "type": "popular_product",
        "name": "Popular product",
        "limit": 1,
        "settings": [
          {
            "type": "text",
            "id": "title",
            "label": "Title",
            "default": "Featured product"
          }, {
            "type": "product_list",
            "id": "product_list",
            "label": "Select product"
          }, {
            "type": "range",
            "id": "maximum",
            "label": "Maximum products to show",
            "min": 1,
            "max": 5,
            "step": 1,
            "default": 3
          }
        ]
      }, {
        "type": "image_banner",
        "name": "Image banner",
        "limit": 1,
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "Image banner",
            "info": "Upload image: png, jpg or gif file(1920 x 200px recommended)"
          },
          {
            "type": "url",
            "id": "link",
            "label": "Link"
          },
          {
            "type": "checkbox",
            "id": "open_link",
            "label": "Open link in new window",
            "default": false
          },
          {
            "type": "select",
            "id": "image_ratio",
            "default": "original",
            "label": "Image ratio",
            "options": [
              {
                "value": "original",
                "label": "Original aspect ratio"
              },
              {
                "value": "1/1",
                "label": "1:1"
              },
              {
                "value": "3/4",
                "label": "3:4"
              },
              {
                "value": "4/3",
                "label": "4:3"
              }, {
                "value": "16/9",
                "label": "16:9"
              }, {
                "value": "custom",
                "label": "Custom ratio"
              }
            ]
          }, {
            "type": "text",
            "id": "custom_ratio",
            "label": "Custom ratio",
            "default": "21:9"
          }, {
            "type": "checkbox",
            "id": "border_radius_img",
            "label": "Border radius image",
            "default": true
          }
        ]
      }
    ]
  }
{% endschema %}