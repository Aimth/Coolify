{%- liquid
  assign gst = settings
  assign border = gst.border_item
  assign show_quick_view = gst.show_quick_view
  assign show_add_to_cart = gst.show_add_to_cart
  assign show_wishlist = gst.show_wishlist
  assign show_vendor = gst.show_vendor
  assign enable_hover_image = gst.enable_hover_image
  assign enable_sale_label = gst.enable_sale_label
  assign compare_at_price = card_product.compare_at_price
  assign price = card_product.price
  assign sale = false
  if compare_at_price > price and compare_at_price != blank
    assign sale = true
  endif

  assign label = false
  if sale == true
    assign label = true
  endif

  assign radius_label = '--border-radius: 0'
  if gst.product_label_style == 'label-radius'
    assign radius_label = '--border-radius: 16px'
  endif

  assign show_action = true
  if show_add_to_cart != true and show_wishlist != true and show_quick_view != true
    assign show_action = false
  endif

  assign text-align = 'text-left'
  assign justify_content = 'justify-start'
  if gst.card_text_alignment == 'center'
    assign justify_content = 'justify-center'
    assign text-align = 'text-center'
  elsif gst.card_text_alignment == 'right'
    assign text-align = 'text-right'
    assign justify_content = 'justify-end'
  endif


  assign text_transform = gst.product_name_t_transfrom
  assign product_name_line = gst.product_name_line
  assign img = card_product.media

  assign p = compare_at_price | minus: price
  if p > 0
    assign p = p | times: 100.0 | divided_by: compare_at_price | round
  endif
-%}

{%- if card_product and card_product != empty -%}
  <div class="tp-prd-item tp-prd-item-horizo {{ text-align }} flex-1 card-wrapper product-card-wrapper relative {% if border %}prd-item-border{% endif %} {% if price %}product--parent{% endif %}" style="--image-padding: {{ gst.card_image_padding }}px">
    <div class="
        card card--{{ settings.card_style }}
        {% if card_product.featured_media %} card--media{% else %} card--text{% endif %}
        {% if settings.card_style == 'card' %} color-{{ settings.card_color_scheme }} gradient{% endif %}
      ">
      <div class="card__inner bd-radius">
        {%- if card_product.featured_media -%}
          <div class="card__media">
            <a class="tp__img-url" href="{{ card_product.url | within: collection }}">
              <div class="tp__product-main">
                {%- if card_product.has_only_default_variant -%}
                  {%- if img[0] != blank -%}
                    {%- render 'responsive-image' | image: img[0] | type: 'product' | class: 'tp__product-grid tp__product-img-sw' -%}
                  {%- else -%}
                    {%- render 'responsive-image' | type: 'product' | class: 'tp__product-grid-plh' -%}
                  {%- endif -%}
                {%- else -%}
                  {%- for variant in card_product.variants limit: 1 -%}
                    {%- if variant.featured_image != blank -%}
                      {%- render 'responsive-image' | image: variant.featured_image | type: 'product' | class: 'tp__product-grid tp__product-img-sw' -%}
                    {%- else -%}
                      {%- render 'responsive-image' | type: 'product' | class: 'tp__product-grid-plh' -%}
                    {%- endif -%}
                  {%- endfor -%}
                {%- endif -%}
              </div>
            </a>
          </div>
        {%- endif -%}
      </div>
      <div class="card__content">
        <div class="card__information">
          {% if show_sale_review %}
            <div class="flex items-center justify-between">
              {% if gst.show_review %}
                <div
                  class="AirReviews-Widget AirReviews-Widget--Stars {{ justify_content }} flex-1"
                  data-review-avg="{{ card_product.metafields.air_reviews_product.review_avg }}"
                  data-review-count="{{ card_product.metafields.air_reviews_product.review_count }}"></div>
              {%- endif -%}
              {%- if label -%}
                {%- if enable_sale_label and compare_at_price > price and compare_at_price != blank -%}
                  <div class="tp-prd-item__label mb-5 table" style="{{ radius_label }}">

                    <div class="label-inner">
                      -
                      {{- p -}}
                      %
                    </div>

                  </div>
                {%- endif -%}
              {%- endif -%}
            </div>
          {% endif %}

          <h3
            class="card__heading {{ text_transform }}{% if card_product.featured_media or settings.card_style == 'standard' %} h6{% endif %}"
            {% if card_product.featured_media or settings.card_style == 'card' %}
            id="title-{{ section_id }}-{{ card_product.id }}"
            {% endif %}>
            <a
              href="{{ card_product.url }}"
              id="CardLink-{{ section_id }}-{{ card_product.id }}"
              class="  limited-line"
              aria-labelledby="CardLink-{{ section_id }}-{{ card_product.id }} Badge-{{ section_id }}-{{ card_product.id }}"
              style="--line-clamp: {{ product_name_line }}">
              {{ card_product.title | escape }}
            </a>
          </h3>
          <div class="card-information">
            <div
              class="no-js-hidden mb-8"
              id="price-{{ section.id }}-{{ card_product.id }}"
              role="status"
              {{ block.shopify_attributes }}>
              {% render 'price'
                , product: card_product
                , use_variant: true
                , %}
            </div>
            {% if show_variant %}
              {%- assign product_form_id = 'product-form-' | append: section.id -%}
              {% render 'product-variant-picker'
                , product: card_product
                , variant_type: gst.variant_type
                , form_label: false
                , product_form_id: product_form_id
                , option_label: false
              %}
            {% endif %}
          </div>
        </div>
        {%- if show_action -%}
          <div class="tp-prd-item__actions btn-actions mt-10">
            {% if show_add_to_cart %}
              <div
                class="tp-prd-item__atc"
                flow="up"
                tooltip="
            {%- if card_product.selected_or_first_available_variant.available == false or quantity_rule_soldout -%}
              {{ 'products.product.sold_out' | t }}
            {% elsif card_product.selected_or_first_available_variant.available and card_product.selected_or_first_available_variant.inventory_quantity < 1 %}
              {{ 'products.product.pre_order' | t }}
            {%- else -%}
            {{ 'products.product.add_to_cart' | t }}
            {%- endif -%}
            ">
                {% if card_product.options.size > 1 and gst.variant_type == 'color_variant' %}
                  <button
                    button-quick-view
                    type="button"
                    aria-label="Add to quick view"
                    class="button-quick-view shadow"
                    data-product-handle="{{ card_product.handle }}">
                    <span class="text-add-to-cart pointer-events-none">
                      {% render 'icon'
                        , icon_name: 'cart' %}
                    </span>
                    <span class="tp-loading tp-loading-cart opacity-0 pointer-events-none" loader>
                      {% render 'icon'
                        , icon_name: 'icon-loading'
                        , color: 'var(--border-color)' %}
                    </span>
                  </button>
                {% else %}
                  {%- if card_product != blank -%}
                    <product-form class="product-form">
                      <div
                        class="product-form__error-message-wrapper flex items-center mb-8"
                        role="alert"
                        hidden>
                        <span class="product-form__error-message text-sm bg-white shadow px-4 py-4"></span>
                      </div>

                      {%- form 'product'
                        , card_product
                        , id: product_form_id
                        , class: 'form'
                        , novalidate: 'novalidate'
                        , data-type: 'add-to-cart-form' -%}
                        <input
                          type="hidden"
                          name="id"
                          value="{{ card_product.selected_or_first_available_variant.id }}"
                          disabled
                          class="product-variant-id">
                        <div class="product-form__buttons">
                          <button
                            id="ProductSubmitButton-{{ section_id }}"
                            type="submit"
                            name="add"
                            class="product-form__submit shadow"
                            data-ds="{{ card_product.selected_or_first_available_variant.available }}"
                            {% if card_product.selected_or_first_available_variant.available == false or quantity_rule_soldout %}
                            disabled
                            {% endif %}>

                            <span class="product-form-btn-text pointer-events-none">

                              {% render 'icon'
                                , icon_name: 'cart' %}

                            </span>
                            <span class="tp-loading opacity-0 pointer-events-none" loader>
                              {% render 'icon'
                                , icon_name: 'icon-loading'
                                , color: 'var(--border-color)' %}
                            </span>
                          </button>
                        </div>
                      {%- endform -%}
                    </product-form>
                  {%- else -%}
                    <div class="product-form">
                      <div class="product-form__buttons form">
                        <button
                          type="submit"
                          name="add"
                          class="product-form__submit button button--full-width button--primary"
                          disabled>
                          {{ 'products.product.sold_out' | t }}
                        </button>
                      </div>
                    </div>
                  {%- endif -%}
                {% endif %}
              </div>
            {% endif %}
            {% if show_wishlist %}
              <div
                flow="up"
                tooltip="{{ 'product_items.wishlist' | t }}"
                class="mb-2">
                {%- render 'button-wishlist'
                  , product: card_product -%}
              </div>
            {% endif %}
            {% if show_quick_view %}
              <div
                flow="up"
                tooltip="{{ 'product_items.quick_view' | t }}"
                class="mb-2">
                {% render 'button-quick-view'
                  , product: card_product %}
              </div>
            {% endif %}
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
{% else %}
  <div class="tp-prd-item tp-prd-item-horizo {{ text-align }} flex-1 card-wrapper product-card-wrapper relative {% if border %}prd-item-border{% endif %} {% if price %}product--parent{% endif %}" style="--image-padding: {{ gst.card_image_padding }}px">
    <div class="
      card card--{{ settings.card_style }}
      {% if card_product.featured_media %} card--media{% else %} card--text{% endif %}
      {% if settings.card_style == 'card' %} color-{{ settings.card_color_scheme }} gradient{% endif %}
    " style="{{ radius_img }}">
      <div class="card__inner">
        {{ 'product-apparel-2' | placeholder_svg_tag: 'placeholder-svg w-full h-[120px]' }}
      </div>
      <div class="card__content">
        <div class="card__information">
          <h3 class="card__heading h6">
            <a
              role="link"
              aria-disabled="true"
              class=" ">
              {{ 'onboarding.product_title' | t }}
            </a>
          </h3>
          <div class="card-information">
            {% render 'price' %}
          </div>
        </div>
      </div>
    </div>
  </div>
{%- endif -%}