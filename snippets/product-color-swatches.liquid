{%- liquid
  assign gst = settings
  assign justify_content = 'justify-start'
  if gst.card_text_alignment == 'center'
    assign justify_content = 'justify-center'
  elsif gst.card_text_alignment == 'right'
    assign justify_content = 'justify-end'
  endif
  assign variants_available_arr = product.variants | map: 'available'
  assign variants_option1_arr = product.variants | map: 'option1'
  assign variants_option2_arr = product.variants | map: 'option2'
  assign variants_option3_arr = product.variants | map: 'option3'
-%}
{% unless product.has_only_default_variant %}
  <div class="tp__product-option option_color flex {{ justify_content }} mt-9">
    {%- for option in product.options_with_values -%}

      {%- if option.name == 'Color' -%}
        <fieldset class="product-form__input tp-prd-variant tp-prd-variant-{{ option.name | downcase }}">
          <div class="variatn-option flex flex-wrap items-center {{ justify_content }} gap-8" data-op="{{ option }}">
            {%- for value in option.values -%}

              {%- liquid
                assign option_disabled = true
                if variants_available_arr[forloop.index0] == true
                  if has_active == true
                    assign classActive = 'not-active'
                  else
                    assign classActive = 'active'
                    assign has_active = true
                  endif
                else
                  assign classActive = 'not-active'
                endif
                for option1_name in variants_option1_arr
                  case option.position
                    when 1
                      if variants_option1_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                        assign option_disabled = false
                      endif
                    when 2
                      if option1_name == product.selected_or_first_available_variant.option1 and variants_option2_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                        assign option_disabled = false
                      endif
                    when 3
                      if option1_name == product.selected_or_first_available_variant.option1 and variants_option2_arr[forloop.index0] == product.selected_or_first_available_variant.option2 and variants_option3_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                        assign option_disabled = false
                      endif
                  endcase
                endfor
              -%}

              <div
                class="tp__product-color-swatches tp__option-swatch-js {% if forloop.index <= 4 %}always-show{% else %}hidden{% endif %} {{ classActive }} {% if option_disabled %}pointer-events-none{% endif %}"
                data-value="{{ value }}"
                data-color="{{ value | downcase }}"
                data-position="{{ option.position }}"
                data-image="{{ product.variants[forloop.index0].featured_image | img_url }}">
                <span flow="up" tooltip="{{ value | escape }}">
                  <label
                    class="mb-8 variants-item block data-variant-js tp-custom-{{ value | downcase | replace: ' ', '-' }} {% if option_disabled %}disabled pointer-events-none{% endif %}"
                    id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
                    name="{{ option.name }}"
                    form="{{ product_form_id }}"
                    data-value="{{ value | escape }}"
                    style="background: {{ value | escape | downcase }}; font-size:0;
                      {% if value == 'White' %}
                      border: 1px solid #ccc;
                      {% endif %}
                    ">
                    {{ value -}}
                    <span class="visually-hidden">{{ 'products.product.variant_sold_out_or_unavailable' | t }}</span>
                    <span class="icon-active-variant">
                      <span class="checkbox"></span>
                    </span>
                  </label>

                </span>
              </div>
              {% if forloop.last and forloop.index > 4 %}
                <a href="{{ product.url }}" class="n-hvr image-variant-btn mb-8">
                  +{{ forloop.index | minus: 4 }}</a>
              {% endif %}
            {%- endfor -%}
          </div>
        </fieldset>

      {%- endif -%}
    {%- endfor -%}
  </div>
{% endunless %}