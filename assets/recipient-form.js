(()=>{function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,c=[],s=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);s=!0);}catch(e){u=!0,i=e}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw i}}return c}}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,p(n.key),n)}}function a(e,r,n){return r=d(r),function(e,r){if(r&&("object"===t(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}(e,u()?Reflect.construct(r,n||[],d(e).constructor):r.apply(e,n))}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e){var t="function"==typeof Map?new Map:void 0;return s=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(u())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&l(i,r.prototype),i}(e,arguments,d(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),l(r,e)},s(e)}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function f(e,t,r){return(t=p(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e){var r=function(e,r){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,r||"default");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==t(r)?r:String(r)}customElements.get("recipient-form")||customElements.define("recipient-form",function(n){function i(){var e,t,r,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),f(c(n=a(this,i)),"cartUpdateUnsubscriber",void 0),f(c(n),"variantChangeUnsubscriber",void 0),f(c(n),"cartErrorUnsubscriber",void 0),n.type=n.dataset.type,n.checkboxInput=n.querySelector("#Recipient-checkbox-".concat(n.dataset.sectionId)),n.checkboxInput.disabled=!1,n.hiddenControlField=n.querySelector("#Recipient-control-".concat(n.dataset.sectionId)),n.hiddenControlField.disabled=!0,n.emailInput=n.querySelector("#Recipient-email-".concat(n.dataset.sectionId)),n.nameInput=n.querySelector("#Recipient-name-".concat(n.dataset.sectionId)),n.messageInput=n.querySelector("#Recipient-message-".concat(n.dataset.sectionId)),n.sendonInput=n.querySelector("#Recipient-send-on-".concat(n.dataset.sectionId)),n.offsetProperty=n.querySelector("#Recipient-timezone-offset-".concat(n.dataset.sectionId)),n.offsetProperty&&(n.offsetProperty.value=(new Date).getTimezoneOffset().toString()),n.errorMessageWrapper=n.querySelector(".product-form__recipient-error-message-wrapper"),n.errorMessageList=null===(e=n.errorMessageWrapper)||void 0===e?void 0:e.querySelector("ul"),n.errorMessage=null===(t=n.errorMessageWrapper)||void 0===t?void 0:t.querySelector(".error-message"),n.defaultErrorHeader=null===(r=n.errorMessage)||void 0===r?void 0:r.innerText,n.currentProductVariantId=n.dataset.productVariantId,n.addEventListener("change",n.onChange.bind(c(n))),n.onChange(),n}var s,u,d;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(i,n),s=i,(u=[{key:"connectedCallback",value:function(){var e=this;this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,(function(t){"product-form"===t.source&&t.productVariantId&&t.productVariantId.toString()===e.currentProductVariantId&&e.resetRecipientForm()})),this.variantChangeUnsubscriber=subscribe(PUB_SUB_EVENTS.variantChange,(function(t){t.data.sectionId===e.dataset.sectionId&&(e.currentProductVariantId=t.data.variant.id.toString())})),this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartError,(function(t){"product-form"===t.source&&t.productVariantId.toString()===e.currentProductVariantId&&e.displayErrorMessage(t.message,t.errors)}))}},{key:"disconnectedCallback",value:function(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber(),this.variantChangeUnsubscriber&&this.variantChangeUnsubscriber(),this.cartErrorUnsubscriber&&this.cartErrorUnsubscriber()}},{key:"onChange",value:function(){this.checkboxInput.checked?this.enableInputFields():"custom_field"!=this.type&&(this.clearInputFields(),this.disableInputFields(),this.clearErrorMessage())}},{key:"inputFields",value:function(){return"custom_field"==this.type?[this.messageInput]:[this.emailInput,this.nameInput,this.messageInput,this.sendonInput]}},{key:"disableableFields",value:function(){return[].concat(r(this.inputFields()),[this.offsetProperty])}},{key:"clearInputFields",value:function(){this.inputFields().forEach((function(e){return e.value=""}))}},{key:"enableInputFields",value:function(){this.disableableFields().forEach((function(e){return e.disabled=!1}))}},{key:"disableInputFields",value:function(){this.disableableFields().forEach((function(e){return e.disabled=!0}))}},{key:"displayErrorMessage",value:function(r,n){var i=this;if(this.clearErrorMessage(),this.errorMessageWrapper&&(this.errorMessageWrapper.hidden=!1),"object"===t(n))return this.errorMessage.innerText=this.defaultErrorHeader,Object.entries(n).forEach((function(t){var r=e(t,2),n=r[0],o=r[1],a="RecipientForm-".concat(n,"-error-").concat(i.dataset.sectionId),c="#Recipient-".concat(n,"-").concat(i.dataset.sectionId),s="".concat(o.join(", ")),u=i.querySelector("#".concat(a)),l=null==u?void 0:u.querySelector(".error-message");if(l){i.errorMessageList&&i.errorMessageList.appendChild(i.createErrorListItem(c,s)),l.innerText="".concat(s,"."),u.classList.remove("hidden");var d=i["".concat(n,"Input")];d&&(d.setAttribute("aria-invalid",!0),d.setAttribute("aria-describedby",a))}}));this.errorMessage.innerText=n}},{key:"createErrorListItem",value:function(e,t){var r=document.createElement("li"),n=document.createElement("a");return n.setAttribute("href",e),n.innerText=t,r.appendChild(n),r.className="error-message",r}},{key:"clearErrorMessage",value:function(){this.errorMessageWrapper&&(this.errorMessageWrapper.hidden=!0),this.errorMessageList&&(this.errorMessageList.innerHTML=""),this.querySelectorAll(".recipient-fields .form__message").forEach((function(e){e.classList.add("hidden");var t=e.querySelector(".error-message");t&&(t.innerText="")})),"custom_field"==this.type?[this.messageInput].forEach((function(e){e.setAttribute("aria-invalid",!1),e.removeAttribute("aria-describedby")})):[this.emailInput,this.messageInput,this.nameInput,this.sendonInput].forEach((function(e){e.setAttribute("aria-invalid",!1),e.removeAttribute("aria-describedby")}))}},{key:"resetRecipientForm",value:function(){this.checkboxInput.checked&&(this.checkboxInput.checked=!1,this.clearInputFields(),this.clearErrorMessage())}}])&&o(s.prototype,u),d&&o(s,d),Object.defineProperty(s,"prototype",{writable:!1}),i}(s(HTMLElement)))})();